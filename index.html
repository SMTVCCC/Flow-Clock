<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒæµæ—¶é’Ÿ(Flow Clock)</title>
    <style>
        :root {
            --bg-primary: #121212;
            --text-primary: #ffffff;
            --accent-color: #00bcd4;
            --ring-bg: rgba(255, 255, 255, 0.1);
        }

        [data-theme="light"] {
            --bg-primary: #f7f9fc;
            --text-primary: #2d3748;
            --ring-bg: rgba(0, 0, 0, 0.05);
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
            transition: background-color 0.3s ease;
        }

        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            
            .controls {
                gap: 0.5rem;
                margin-top: 1.5rem;
            }
            
            .motivation {
                margin-top: 1.5rem;
                max-width: 95%;
            }
        }

        @media (max-width: 480px) {
            .timer-container {
                width: min(350px, 90vw);
                height: min(350px, 90vw);
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
                gap: 0.75rem;
            }
            
            button {
                width: 200px;
            }
        }

        .timer-container {
            position: relative;
            width: min(400px, 80vw);
            height: min(400px, 80vw);
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            stroke-width: 8;
            stroke: var(--accent-color);
            fill: transparent;
            transition: stroke-dashoffset 0.5s linear;
        }

        .progress-ring-bg {
            stroke-width: 8;
            stroke: var(--ring-bg);
            fill: transparent;
        }

        .time-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            font-weight: 300;
        }

        .controls {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--accent-color);
            border-radius: 50px;
            padding: clamp(0.75rem, 2vw, 1rem) clamp(1.5rem, 4vw, 2.5rem);
            font-size: clamp(1rem, 3vw, 1.3rem);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        button:hover {
            background: var(--accent-color);
            color: var(--bg-primary);
        }

        .motivation {
            margin-top: 2rem;
            font-size: clamp(1rem, 3vw, 1.5rem);
            text-align: center;
            min-height: clamp(60px, 10vw, 80px);
            max-width: 90%;
            font-style: italic;
            opacity: 0.8;
            transition: opacity 0.5s ease;
            padding: 0 1rem;
        }

        .top-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-switch, .focus-mode {
            cursor: pointer;
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .theme-switch:hover, .focus-mode:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .focus-mode {
            background: transparent;
            border: 1px solid var(--accent-color);
            color: var(--text-primary);
            border-radius: 20px;
            padding: 5px 10px;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }

        .focus-mode:hover {
            background: var(--accent-color);
            color: var(--bg-primary);
        }

        .help-btn {
            background: transparent;
            border: 1px solid var(--accent-color);
            color: var(--text-primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .help-btn:hover {
            background: var(--accent-color);
            color: var(--bg-primary);
        }

        .stats {
            margin-top: 1rem;
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            opacity: 0.7;
        }
    </style>
    <div id="safari-warning" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: #ffcc00; color: black; padding: 10px 20px; border-radius: 5px; z-index: 2000; font-size: 0.9rem;">
        æç¤ºï¼šSafariæµè§ˆå™¨å¯èƒ½æ— æ³•è‡ªåŠ¨æ’­æ”¾å£°éŸ³ï¼Œå»ºè®®ä½¿ç”¨Chromeæˆ–Firefoxä»¥è·å¾—æœ€ä½³ä½“éªŒã€‚
    </div>
</head>
<body>
    <div class="top-controls">
        <div class="theme-switch" id="themeToggle">ğŸŒ“</div>
        <div class="focus-mode" id="focusMode">ä¸“æ³¨</div>
        <div class="help-btn" id="helpBtn">?</div>
    </div>
    
    <div class="timer-container">
        <svg class="progress-ring" width="100%" height="100%" viewBox="0 0 400 400">
            <circle class="progress-ring-bg" r="190" cx="200" cy="200"></circle>
            <circle class="progress-ring-circle" stroke-dasharray="1194" r="190" cx="200" cy="200"></circle>
        </svg>
        <div class="time-display" id="timeDisplay">00:00</div>
    </div>
    
    <div class="controls" id="controls">
        <button id="startBtn">å¼€å§‹ä¸“æ³¨</button>
        <button id="stopBtn">åœæ­¢</button>
    </div>
    
    <div class="break-message" id="breakMessage" style="display: none; margin-top: 1rem; font-size: clamp(1rem, 3vw, 1.5rem); color: var(--accent-color); text-align: center; font-weight: bold;"></div>
    
    <div class="skip-break-container" id="skipBreakContainer" style="display: none; margin-top: 1rem; text-align: center;">
        <button id="skipBreakBtn" style="padding: 0.5rem 1rem; font-size: 0.9rem; background: var(--accent-color); color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">è·³è¿‡ä¼‘æ¯</button>
    </div>
    
    <!-- è‡ªå®šä¹‰å¼¹çª— -->
    <div class="modal-overlay" id="modalOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; backdrop-filter: blur(5px);">
        <div class="modal" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-color); border-radius: 16px; padding: 2rem; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); min-width: 300px; text-align: center;">
            <div class="modal-content" id="modalContent" style="color: var(--text-color); font-size: 1.1rem; line-height: 1.5; margin-bottom: 1.5rem;"></div>
            <div class="modal-buttons" id="modalButtons" style="display: flex; gap: 1rem; justify-content: center;"></div>
        </div>
    </div>
    
    <div class="stats" id="stats"></div>
    <div style="display: none;">
        æœ¬æ¬¡ä¸“æ³¨: <span id="sessionTime">0</span> åˆ†é’Ÿ
    </div>
    
    <div class="motivation" id="motivationText">æ”¾å¼ƒä¸éš¾ï¼Œä½†åšæŒä¸€å®šå¾ˆNBï¼</div>
    
    <audio id="shortBreakSound" preload="auto">
<source src="1.mp3" type="audio/mpeg">
</audio>

<audio id="longBreakSound" preload="auto">
<source src="2.mp3" type="audio/mpeg">
</audio>

    <script>
        // DOMå…ƒç´ 
        const timeDisplay = document.getElementById('timeDisplay');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const themeToggle = document.getElementById('themeToggle');
        const focusMode = document.getElementById('focusMode');
        const motivationText = document.getElementById('motivationText');
        const sessionTime = document.getElementById('sessionTime');
        const circle = document.querySelector('.progress-ring-circle');
        const shortBreakSound = document.getElementById('shortBreakSound');
        const longBreakSound = document.getElementById('longBreakSound');
        const controls = document.getElementById('controls');
        const stats = document.getElementById('stats');
        const breakMessage = document.getElementById('breakMessage');
        const skipBreakContainer = document.getElementById('skipBreakContainer');
        const skipBreakBtn = document.getElementById('skipBreakBtn');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalContent = document.getElementById('modalContent');
        const modalButtons = document.getElementById('modalButtons');
        const helpBtn = document.getElementById('helpBtn');
        
        // é…ç½®å‚æ•°
        const config = {
            minShortInterval: 3 * 60,    // 3åˆ†é’Ÿï¼ˆç§’ï¼‰
            maxShortInterval: 5 * 60,     // 5åˆ†é’Ÿï¼ˆç§’ï¼‰
            longInterval: 90 * 60,        // 90åˆ†é’Ÿï¼ˆç§’ï¼‰
            shortBreakDuration: 10,        // 10ç§’
            longBreakDuration: 20 * 60     // 20åˆ†é’Ÿ
        };
        
        // çŠ¶æ€å˜é‡
        let timer = null;
        let breakTimer = null;
        let secondsRemaining = 0;
        let totalSeconds = 0;
        let isRunning = false;
        let startTime = null;
        let accumulatedTime = 0;
        let nextBreakTime = null;
        let nextBreakDuration = 0;
        let isBreaking = false;
        let breakSecondsRemaining = 0;
        let savedSecondsRemaining = 0;
        
        // æ¿€åŠ±è¯­å¥åº“
        const motivations = [
            "æ”¾å¼ƒä¸éš¾ï¼Œä½†åšæŒä¸€å®šå¾ˆNBï¼",
            "èººå¹³å¾ˆç®€å•ï¼Œç«™èµ·æ¥è¯•è¯•ï¼Ÿ",
            "æ”¾å¼ƒä¸éš¾ï¼Œä½†åšæŒä¸€å®šå¾ˆNBï¼",
            "ä»Šæ—¥æµä¸‹çš„æ±—æ°´ï¼Œç»ˆå°†æˆä¸ºæ˜å¤©ç…§äº®å‰è·¯çš„å…‰ ï¼",
            "æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œæ—¶é—´ä¼šç»™ä½ ç­”æ¡ˆ",
            "ä»Šå¤©çš„æ±—æ°´ï¼Œæ˜¯æ˜å¤©çš„æŒå£°ï¼",
            "ä½ åªç®¡åŠªåŠ›ï¼Œå‰©ä¸‹çš„äº¤ç»™æ—¶é—´",
            "æƒ³ä¸€åƒæ¬¡ï¼Œä¸å¦‚åšä¸€æ¬¡ï¼Just Do Itï¼",
            "å†æ’‘äº”åˆ†é’Ÿï¼å†æ’‘äº”åˆ†é’Ÿï¼",
            "å€’ä¸‹äº†ï¼Ÿçˆ¬èµ·æ¥ç»§ç»­ï¼",
            "åˆ«äººåœä¸‹çš„åœ°æ–¹ï¼Œå°±æ˜¯ä½ çš„èµ·ç‚¹ï¼",
            "ä½ çš„åšæŒï¼Œç»ˆå°†ç¾å¥½ï¼",
            "ç›¸ä¿¡è‡ªå·±ï¼Œä½ çœŸçš„æ¯”æƒ³è±¡ä¸­å¼ºå¤§ï¼",
            "ä¸æ”¾å¼ƒå°±æ˜¯æœ€å¤§çš„èƒœåˆ©ï¼",
            "æ²¡æœ‰ç™½èµ°çš„è·¯ï¼Œæ¯ä¸€æ­¥éƒ½ç®—æ•°ï¼",
            "ç´¯äº†å°±æ­‡ä¼šå„¿ï¼Œä½†åˆ«æ‰å¤´ï¼",
            "ä½ æƒ³è®¤è¾“ï¼Ÿé—®è¿‡æ˜¨å¤©çš„åŠªåŠ›å—ï¼",
            "å·ä¸åŠ¨äº†ï¼Ÿå…ˆåˆ«èººï¼Œå–æ¯å¥¶èŒ¶ç»§ç»­å¹²ï¼",
            "æ‘¸é±¼ä¸€æ—¶çˆ½ï¼ŒDDLç«è‘¬åœºï¼",
            "æ‘†çƒ‚è°ä¸ä¼šï¼Ÿæ”¯æ£±èµ·æ¥æ‰å«é…·ï¼",
            "ä»Šå¤©çš„ä½ ï¼Œæ¯”æ˜¨å¤©çš„ä½ æ›´NBï¼",
            "åŠªåŠ›ä¸ä¸€å®šæˆåŠŸï¼Œä½†æ”¾å¼ƒä¸€å®šå¾ˆè½»æ¾ï¼ï¼ˆåå·ç‰ˆï¼‰",
            "åˆ’æ°´æ˜¯æœ¬èƒ½ï¼ŒåšæŒæ˜¯æœ¬äº‹ï¼",
            "ä½ å·ä»»ä½ å·ï¼Œæˆ‘å½“èµ›åšç¥ä»™",
            "é—´æ­‡æ€§é¸¡è¡€ï¼ŒæŒç»­æ€§èººå¹³ï¼Œä½†æ­¤åˆ»è¦ä¸“æ³¨ï¼",
            "èººä¸å¹³å·ä¸èµ¢ï¼Œé‚£å°±45åº¦äººç”Ÿï¼",
            "æ‘†åˆæ‘†ä¸çƒ‚ï¼Œå·åˆå·ä¸èµ¢ï¼Œå­¦åˆå­¦ä¸è¿›â€”â€”å…ˆä¸“æ³¨ï¼",
            "äººç”Ÿå°±åƒè¿›åº¦æ¡ï¼Œæ’‘è¿‡99%å¡é¡¿æœŸå°±æ˜¯åŠ è½½å®Œæˆï¼",
            "åˆ«è®©æŠ–éŸ³å·èµ°ä½ çš„æ—¶é—´ï¼Œä¸“æ³¨å½“ä¸‹ï¼",
            "èººå¹³æ˜¯å¤©èµ‹ï¼ŒåšæŒæ˜¯è¶…èƒ½åŠ›ï¼",
            "ä½ å¯ä»¥èœï¼Œä½†ä¸èƒ½ä¸åŠªåŠ›ï¼",
            "ä½ åŠªåŠ›çš„æ ·å­ï¼Œåƒæäº†æœŸæœ«è€ƒå‰å¤œçš„è‡ªå·±ï¼",
            "æ”¾å¼ƒå¾ˆç®€å•ï¼Œä½†åšæŒå¾ˆcoooolï¼",
            "æ‚„æ‚„åŠªåŠ›ï¼Œç„¶åæƒŠè‰³æ‰€æœ‰äººï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ï¼",
            "æ‘†çƒ‚äº”åˆ†é’Ÿï¼Œå·ç‹ä¸¤å°æ—¶ï¼",
            "åšæŒä¸ä¸‹å»ï¼Ÿæƒ³æƒ³ä½ çš„çˆ±è±†æœ‰å¤šæ‹¼ï¼",
            "æ”¾ä¸‹æ‰‹æœºå§ï¼Œå¥½å“¥å§/.",
            "é»‘å¤œå†é•¿ï¼Œå¤ªé˜³æ€»ä¼šå‡èµ·"
        ];
        
        // åˆå§‹åŒ–
        function init() {
            updateMotivation();
            setInterval(updateMotivation, 15000); // æ¯15ç§’æ›´æ–°ä¸€æ¬¡æ¿€åŠ±è¯­
        }
        
        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            if (isRunning) return;
            
            startTime = new Date();
            isRunning = true;
            startBtn.textContent = "ç»“æŸè®¡æ—¶";
            stopBtn.textContent = "æš‚åœ";
            
            // è®¾ç½®ä¸‹æ¬¡ä¼‘æ¯æ—¶é—´ï¼ˆéšæœº3-5åˆ†é’Ÿï¼‰
            setNextBreak();
            
            timer = setInterval(updateTimer, 1000);
        }
        
        // ç»“æŸè®¡æ—¶å™¨
        function endTimer() {
            if (!isRunning) return;
            
            clearInterval(timer);
            isRunning = false;
            
            // è®¡ç®—ä¸“æ³¨æ—¶é•¿
            const focusMinutes = Math.floor(accumulatedTime / 60);
            const focusSeconds = accumulatedTime % 60;
            
            let timeText = "";
            if (focusMinutes > 0) {
                timeText = `${focusMinutes}åˆ†é’Ÿ`;
                if (focusSeconds > 0) {
                    timeText += `${focusSeconds}ç§’`;
                }
            } else {
                timeText = `${focusSeconds}ç§’`;
            }
            
            // æ˜¾ç¤ºé¼“åŠ±ä¿¡æ¯
            showModal(
                `ğŸ‰ æœ¬æ¬¡ä¸“æ³¨äº†${timeText}ï¼Œå¤ªæ£’äº†ï¼Œå†æ¥å†å‰ï¼`,
                [
                    {
                        text: 'å¥½çš„',
                        primary: true,
                        onclick: () => {
                            hideModal();
                            resetTimer();
                        }
                    }
                ]
            );
        }
        
        // é‡ç½®è®¡æ—¶å™¨
        function resetTimer() {
            clearInterval(timer);
            isRunning = false;
            secondsRemaining = 0;
            accumulatedTime = 0;
            totalSeconds = 0;
            nextBreakTime = null;
            
            startBtn.textContent = "å¼€å§‹ä¸“æ³¨";
            stopBtn.textContent = "åœæ­¢";
            
            // é‡ç½®æ˜¾ç¤º
            updateDisplay();
            sessionTime.textContent = "0";
        }
        
        // æš‚åœ/ç»§ç»­è®¡æ—¶å™¨
        function pauseTimer() {
            if (!isRunning) {
                // å½“å‰æ˜¯æš‚åœçŠ¶æ€ï¼Œç»§ç»­è®¡æ—¶
                isRunning = true;
                stopBtn.textContent = "æš‚åœ";
                timer = setInterval(updateTimer, 1000);
            } else {
                // å½“å‰æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œæš‚åœè®¡æ—¶
                clearInterval(timer);
                isRunning = false;
                stopBtn.textContent = "ç»§ç»­";
            }
        }
        
        // æ˜¾ç¤ºè‡ªå®šä¹‰å¼¹çª—
        function showModal(content, buttons) {
            modalContent.innerHTML = content;
            modalButtons.innerHTML = '';
            
            buttons.forEach(button => {
                const btn = document.createElement('button');
                btn.textContent = button.text;
                btn.style.cssText = `
                    padding: 0.75rem 1.5rem;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    ${button.primary ? 
                        'background: var(--accent-color); color: white;' : 
                        'background: var(--border-color); color: var(--text-color);'
                    }
                `;
                btn.onclick = button.onclick;
                modalButtons.appendChild(btn);
            });
            
            modalOverlay.style.display = 'block';
        }
        
        // éšè—è‡ªå®šä¹‰å¼¹çª—
        function hideModal() {
            modalOverlay.style.display = 'none';
        }
        
        // è·³è¿‡ä¼‘æ¯
        function skipBreak() {
            showModal(
                'ç¡®å®šè·³è¿‡ä¼‘æ¯å—ï¼Ÿä¼‘æ¯ä¹Ÿå¾ˆé‡è¦çš„ï¼',
                [
                    {
                        text: 'å–æ¶ˆ',
                        primary: false,
                        onclick: hideModal
                    },
                    {
                        text: 'ç¡®å®šè·³è¿‡',
                        primary: true,
                        onclick: () => {
                            hideModal();
                            
                            // æ¸…é™¤ä¼‘æ¯è®¡æ—¶å™¨
                            if (breakTimer) {
                                clearInterval(breakTimer);
                                breakTimer = null;
                            }
                            
                            // ç»“æŸä¼‘æ¯çŠ¶æ€
                            isBreaking = false;
                            
                            // æ¢å¤ç•Œé¢
                            controls.style.display = 'flex';
                            stats.style.display = 'block';
                            motivationText.style.display = 'block';
                            breakMessage.style.display = 'none';
                            skipBreakContainer.style.display = 'none';
                            
                            // æ¢å¤è®¡æ—¶çŠ¶æ€
                            secondsRemaining = savedSecondsRemaining;
                            
                            // è®¾ç½®ä¸‹æ¬¡ä¼‘æ¯æ—¶é—´
                            setNextBreak();
                            
                            // ç»§ç»­è®¡æ—¶
                            startTimer();
                        }
                    }
                ]
            );
        }
        
        // è®¾ç½®ä¸‹æ¬¡ä¼‘æ¯æ—¶é—´
        function setNextBreak() {
            const nextInterval = Math.floor(
                Math.random() * (config.maxShortInterval - config.minShortInterval + 1)
            ) + config.minShortInterval;
            
            nextBreakTime = secondsRemaining + nextInterval;
            nextBreakDuration = config.shortBreakDuration;
        }
        
        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            secondsRemaining++;
            totalSeconds++;
            accumulatedTime++;
            
            // æ›´æ–°ä¸“æ³¨æ—¶é—´ç»Ÿè®¡
            sessionTime.textContent = Math.floor(accumulatedTime / 60);
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();
            
            // æ£€æŸ¥ä¼‘æ¯æ—¶é—´
            if (secondsRemaining >= nextBreakTime) {
                if (accumulatedTime >= config.longInterval) {
                    // 90åˆ†é’Ÿé•¿ä¼‘æ¯
                    takeBreak(config.longBreakDuration, true);
                } else {
                    // çŸ­ä¼‘æ¯
                    takeBreak(config.shortBreakDuration, false);
                }
            }
        }
        
        // ä¼‘æ¯å¤„ç†
        function takeBreak(duration, isLongBreak) {
            clearInterval(timer);
            isRunning = false;
            isBreaking = true;
            
            // ä¿å­˜å½“å‰è®¡æ—¶çŠ¶æ€
            savedSecondsRemaining = secondsRemaining;
            
            // æ’­æ”¾æç¤ºéŸ³
            if (isLongBreak) {
                longBreakSound.play();
                breakMessage.textContent = "ä¸“æ³¨90åˆ†é’Ÿäº†ï¼è¯·ä¼‘æ¯20åˆ†é’Ÿ";
            } else {
                shortBreakSound.play();
                breakMessage.textContent = "ä¼‘æ¯æ—¶é—´åˆ°ï¼è¯·æ”¾æ¾10ç§’é’Ÿ";
            }
            
            // æ˜¾ç¤ºä¼‘æ¯ç•Œé¢
            controls.style.display = 'none';
            stats.style.display = 'none';
            motivationText.style.display = 'none';
            breakMessage.style.display = 'block';
            skipBreakContainer.style.display = 'block';
            
            // å¼€å§‹ä¼‘æ¯å€’è®¡æ—¶
            breakSecondsRemaining = duration;
            secondsRemaining = duration;            
            breakTimer = setInterval(() => {
                breakSecondsRemaining--;
                secondsRemaining = breakSecondsRemaining;
                updateDisplay();
                
                if (breakSecondsRemaining <= 0) {
                    clearInterval(breakTimer);
                    breakTimer = null;
                    endBreak(isLongBreak);
                }
            }, 1000);
        }
        
        // ç»“æŸä¼‘æ¯
        function endBreak(isLongBreak) {
            isBreaking = false;
            
            // æ¢å¤ç•Œé¢
            controls.style.display = 'flex';
            stats.style.display = 'block';
            motivationText.style.display = 'block';
            breakMessage.style.display = 'none';
            skipBreakContainer.style.display = 'none';
            
            // æ¢å¤è®¡æ—¶çŠ¶æ€
            if (isLongBreak) {
                // é•¿ä¼‘æ¯åé‡ç½®
                secondsRemaining = 0;
                accumulatedTime = 0;
            } else {
                // çŸ­ä¼‘æ¯åç»§ç»­ä¹‹å‰çš„è®¡æ—¶
                secondsRemaining = savedSecondsRemaining;
            }
            
            // è®¾ç½®ä¸‹æ¬¡ä¼‘æ¯æ—¶é—´
            if (!isLongBreak) {
                setNextBreak();
            } else {
                // é•¿ä¼‘æ¯åé‡æ–°å¼€å§‹
                setNextBreak();
            }
            
            // ç»§ç»­è®¡æ—¶
            startTimer();
        }
        

        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const minutes = Math.floor(secondsRemaining / 60);
            const seconds = secondsRemaining % 60;
            timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // æ›´æ–°è¿›åº¦ç¯
            if (isBreaking) {
                // ä¼‘æ¯æ—¶æ˜¾ç¤ºä¼‘æ¯å€’è®¡æ—¶è¿›åº¦
                const totalBreakTime = breakSecondsRemaining + (secondsRemaining - breakSecondsRemaining);
                const progress = ((totalBreakTime - secondsRemaining) / totalBreakTime) * 100;
                const offset = 1194 - (1194 * progress / 100);
                circle.style.strokeDashoffset = offset;
                circle.style.stroke = '#ff6b6b'; // ä¼‘æ¯æ—¶ä½¿ç”¨çº¢è‰²
            } else if (nextBreakTime) {
                // æ­£å¸¸è®¡æ—¶æ—¶æ˜¾ç¤ºåˆ°ä¸‹æ¬¡ä¼‘æ¯çš„è¿›åº¦
                const progress = (secondsRemaining / nextBreakTime) * 100;
                const offset = 1194 - (1194 * progress / 100);
                circle.style.strokeDashoffset = offset;
                circle.style.stroke = 'var(--accent-color)'; // æ¢å¤æ­£å¸¸é¢œè‰²
            }
        }
        
        // æ›´æ–°æ¿€åŠ±è¯­
        function updateMotivation() {
            motivationText.style.opacity = 0;
            
            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * motivations.length);
                motivationText.textContent = motivations[randomIndex];
                motivationText.style.opacity = 0.8;
            }, 300);
        }
        
        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            themeToggle.textContent = newTheme === 'dark' ? 'ğŸŒ“' : 'ğŸŒ';
        }

        // åˆ‡æ¢ä¸“æ³¨æ¨¡å¼ï¼ˆå…¨å±ï¼‰
        function toggleFocusMode() {
            if (!document.fullscreenElement) {
                // è¿›å…¥å…¨å±
                document.documentElement.requestFullscreen().then(() => {
                    focusMode.textContent = 'é€€å‡º';
                }).catch(err => {
                    console.log('æ— æ³•è¿›å…¥å…¨å±æ¨¡å¼:', err);
                });
            } else {
                // é€€å‡ºå…¨å±
                document.exitFullscreen().then(() => {
                    focusMode.textContent = 'ä¸“æ³¨';
                }).catch(err => {
                    console.log('æ— æ³•é€€å‡ºå…¨å±æ¨¡å¼:', err);
                });
            }
        }

        // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                focusMode.textContent = 'é€€å‡º';
            } else {
                focusMode.textContent = 'ä¸“æ³¨';
            }
        });
        
        // äº‹ä»¶ç›‘å¬å™¨
        startBtn.addEventListener('click', () => {
            if (startBtn.textContent === 'å¼€å§‹ä¸“æ³¨') {
                startTimer();
            } else {
                endTimer();
            }
        });

        stopBtn.addEventListener('click', pauseTimer);
        
        skipBreakBtn.addEventListener('click', skipBreak);
        
        // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­å¼¹çª—
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                hideModal();
            }
        });
        themeToggle.addEventListener('click', toggleTheme);
        focusMode.addEventListener('click', toggleFocusMode);
        helpBtn.addEventListener('click', () => {
            window.location.href = 'demo.html';
        });
        
        // åˆå§‹åŒ–
        init();

        // æµè§ˆå™¨æ£€æµ‹
        function checkBrowser() {
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            if (isSafari) {
                const warningDiv = document.getElementById('safari-warning');
                warningDiv.style.display = 'block';
                setTimeout(() => {
                    warningDiv.style.display = 'none';
                }, 3000);
            }
        }
        checkBrowser();
    </script>
</body>
</html>